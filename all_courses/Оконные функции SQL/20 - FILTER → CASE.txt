ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸:

ğŸ¤” FILTER â†’ CASE
Ğ•ÑÑ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½Ğ´ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ° Ğ±ĞµĞ· ÑƒÑ‡ĞµÑ‚Ğ° IT-Ğ¾Ñ‚Ğ´ĞµĞ»Ğ°:

select
  name, city,
  sum(salary) over w as base,
  sum(salary) filter(where department <> 'it') over w as no_it
from employees
window w as (partition by city)
order by city, id;
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚   name   â”‚  city  â”‚ base â”‚ no_it â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ĞšÑĞµĞ½Ğ¸Ñ   â”‚ ĞœĞ¾ÑĞºĞ²Ğ° â”‚ 510  â”‚ 196   â”‚
â”‚ ĞœĞ°Ñ€Ğ¸Ğ½Ğ°   â”‚ ĞœĞ¾ÑĞºĞ²Ğ° â”‚ 510  â”‚ 196   â”‚
â”‚ Ğ˜Ğ²Ğ°Ğ½     â”‚ ĞœĞ¾ÑĞºĞ²Ğ° â”‚ 510  â”‚ 196   â”‚
â”‚ Ğ’ĞµÑ€Ğ¾Ğ½Ğ¸ĞºĞ° â”‚ ĞœĞ¾ÑĞºĞ²Ğ° â”‚ 510  â”‚ 196   â”‚
â”‚ ĞĞ½Ğ½Ğ°     â”‚ ĞœĞ¾ÑĞºĞ²Ğ° â”‚ 510  â”‚ 196   â”‚
â”‚ Ğ”Ğ°Ñ€ÑŒÑ    â”‚ Ğ¡Ğ°Ğ¼Ğ°Ñ€Ğ° â”‚ 432  â”‚ 244   â”‚
â”‚ Ğ‘Ğ¾Ñ€Ğ¸Ñ    â”‚ Ğ¡Ğ°Ğ¼Ğ°Ñ€Ğ° â”‚ 432  â”‚ 244   â”‚
â”‚ Ğ•Ğ»ĞµĞ½Ğ°    â”‚ Ğ¡Ğ°Ğ¼Ğ°Ñ€Ğ° â”‚ 432  â”‚ 244   â”‚
â”‚ Ğ›ĞµĞ¾Ğ½Ğ¸Ğ´   â”‚ Ğ¡Ğ°Ğ¼Ğ°Ñ€Ğ° â”‚ 432  â”‚ 244   â”‚
â”‚ Ğ“Ñ€Ğ¸Ğ³Ğ¾Ñ€Ğ¸Ğ¹ â”‚ Ğ¡Ğ°Ğ¼Ğ°Ñ€Ğ° â”‚ 432  â”‚ 244   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
ĞŸĞµÑ€ĞµĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ‚Ğ°Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ½ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ» case Ğ²Ğ¼ĞµÑÑ‚Ğ¾ filter
----------------------------------------------------------------------------------
ĞœĞ¾Ñ‘ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ:

select
  name, city,
  sum(salary) over w as base,
  sum(case when department <> 'it' then salary else 0 end) over w as no_it
from employees
window w as (partition by city)
order by city, id;