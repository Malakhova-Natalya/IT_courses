ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸:

ğŸ¤” 2020 vs 2019
Ğ•ÑÑ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ sales. ĞŸĞ¾ÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºÑƒ Ğ¿Ğ¾ ĞºĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»Ğ°Ğ¼ 2020 Ğ³Ğ¾Ğ´Ğ°.

Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ĞºĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»Ğ° Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ:

Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºÑƒ Ğ·Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ²Ğ°Ñ€Ñ‚Ğ°Ğ» 2019 Ğ³Ğ¾Ğ´Ğ° (prev);
Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºĞ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ĞºĞ²Ğ°Ñ€Ñ‚Ğ°Ğ»Ğ° Ğ¾Ñ‚ prev (perc).
ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ¾ĞºÑ€ÑƒĞ³Ğ»Ğ¸Ñ‚Ğµ Ğ´Ğ¾ Ñ†ĞµĞ»Ğ¾Ğ³Ğ¾.

â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ year â”‚ quarter â”‚ revenue â”‚  prev  â”‚ perc â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2020 â”‚ 1       â”‚ 242040  â”‚ 155040 â”‚ 156  â”‚
â”‚ 2020 â”‚ 2       â”‚ 338040  â”‚ 162600 â”‚ 208  â”‚
â”‚ 2020 â”‚ 3       â”‚ 287520  â”‚ 204120 â”‚ 141  â”‚
â”‚ 2020 â”‚ 4       â”‚ 377340  â”‚ 200700 â”‚ 188  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°: quarter
----------------------------------------------------------------------------------------
ĞœĞ¾Ñ‘ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ:

WITH quarter_table AS (
SELECT year, month, SUM(revenue) AS revenue,
NTILE(4) OVER w AS quarter
FROM sales
GROUP BY year, month 
WINDOW w AS (PARTITION BY year ORDER BY month)
)
, quarter_revenue AS (
SELECT year, quarter, SUM(revenue) AS revenue
FROM quarter_table
GROUP BY year, quarter
)
SELECT year, quarter, revenue, 
LAG(revenue,4) OVER (ORDER BY year, quarter) AS prev,
ROUND(revenue / LAG(revenue,4) OVER (ORDER BY year, quarter) *100) AS perc
FROM quarter_revenue
ORDER BY year DESC,quarter
LIMIT 4


