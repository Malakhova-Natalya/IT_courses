ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸:

ğŸ¤” Ğ’ĞºĞ»Ğ°Ğ´ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ¾Ğ²
Ğ•ÑÑ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ sales. ĞŸĞ¾ÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ, ĞºĞ°ĞºĞ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ (Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ°Ñ…) Ğ²Ğ½ĞµÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¸Ğ· Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ¾Ğ² Ğ² Ğ¾Ğ±Ñ‰ÑƒÑ Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºÑƒ Ğ·Ğ° Ğ³Ğ¾Ğ´.

ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ¾ĞºÑ€ÑƒĞ³Ğ»Ğ¸Ñ‚Ğµ Ğ´Ğ¾ Ñ†ĞµĞ»Ğ¾Ğ³Ğ¾.

â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ year â”‚   plan   â”‚ revenue â”‚  total  â”‚ perc â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2019 â”‚ gold     â”‚ 252960  â”‚ 722460  â”‚ 35   â”‚
â”‚ 2019 â”‚ platinum â”‚ 168000  â”‚ 722460  â”‚ 23   â”‚
â”‚ 2019 â”‚ silver   â”‚ 301500  â”‚ 722460  â”‚ 42   â”‚
â”‚ 2020 â”‚ gold     â”‚ 411840  â”‚ 1244940 â”‚ 33   â”‚
â”‚ 2020 â”‚ platinum â”‚ 249600  â”‚ 1244940 â”‚ 20   â”‚
â”‚ 2020 â”‚ silver   â”‚ 583500  â”‚ 1244940 â”‚ 47   â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°: year, plan
---------------------------------------------------------------------------------------
ĞœĞ¾Ñ‘ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ:

WITH agg_table AS (
SELECT year, plan, SUM(revenue) AS revenue
FROM sales
GROUP BY year, plan
)

SELECT year, plan, revenue,
SUM(revenue) OVER w AS total,
ROUND(revenue / SUM(revenue) OVER w * 100) AS perc
FROM agg_table
WINDOW w AS (PARTITION BY year)
ORDER BY year, plan
