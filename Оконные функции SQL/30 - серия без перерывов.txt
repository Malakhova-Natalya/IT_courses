ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸:

ðŸ¤” Ð¡ÐµÑ€Ð¸Ñ Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð²Ð¾Ð²
Ð•ÑÑ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° activity, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð±Ð°Ð»Ð»Ñ‹, Ð½Ð°Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸ Ð² ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ð´Ð½Ð¸:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   adate    â”‚ user_id â”‚ points â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2020-02-01 â”‚ 51      â”‚ 1      â”‚
â”‚ 2020-02-02 â”‚ 11      â”‚ 1      â”‚
â”‚ 2020-02-02 â”‚ 51      â”‚ 3      â”‚
â”‚ 2020-02-05 â”‚ 21      â”‚ 6      â”‚
â”‚ ...        â”‚ ...     â”‚ ...    â”‚
â”‚ 2020-02-25 â”‚ 51      â”‚ 1      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ Ð¾ÑÑ‚Ñ€Ð¾Ð²Ð° Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ â€” Ñ‚Ð¾ ÐµÑÑ‚ÑŒ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ñ‹, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð±Ð¸Ñ€Ð°Ð» Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð¸Ð½ Ð±Ð°Ð»Ð» ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð²Ð°. Ð¡ÐµÑ€Ð¸Ñ Ð¸Ð· Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð´Ð½Ñ Ñ‚Ð¾Ð¶Ðµ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ÑÑ.

Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ Ñ‚Ð°Ðº:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_id â”‚ day_start  â”‚  day_end   â”‚ day_count â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 11      â”‚ 2020-02-02 â”‚ 2020-02-11 â”‚ 10        â”‚
â”‚ 11      â”‚ 2020-02-15 â”‚ 2020-02-17 â”‚ 3         â”‚
â”‚ 21      â”‚ 2020-02-05 â”‚ 2020-02-05 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-07 â”‚ 2020-02-07 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-09 â”‚ 2020-02-09 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-11 â”‚ 2020-02-11 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-13 â”‚ 2020-02-13 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-15 â”‚ 2020-02-15 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-20 â”‚ 2020-02-20 â”‚ 1         â”‚
â”‚ 21      â”‚ 2020-02-23 â”‚ 2020-02-24 â”‚ 2         â”‚
â”‚ 31      â”‚ 2020-02-07 â”‚ 2020-02-07 â”‚ 1         â”‚
â”‚ 31      â”‚ 2020-02-11 â”‚ 2020-02-13 â”‚ 3         â”‚
â”‚ 51      â”‚ 2020-02-01 â”‚ 2020-02-05 â”‚ 5         â”‚
â”‚ 51      â”‚ 2020-02-08 â”‚ 2020-02-10 â”‚ 3         â”‚
â”‚ 51      â”‚ 2020-02-20 â”‚ 2020-02-22 â”‚ 3         â”‚
â”‚ 51      â”‚ 2020-02-25 â”‚ 2020-02-25 â”‚ 1         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Ð¡Ñ‚ÐµÐ¿Ð¸Ðº Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ Ð² MySQL, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ to_days(), Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ñ‚Ñƒ Ð² Ñ‡Ð¸ÑÐ»Ð¾. Ð˜Ð»Ð¸ Ð²Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ Ñ€Ð°Ð½Ð³ Ð¿Ñ€ÑÐ¼Ð¾ Ð¸Ð· Ð´Ð°Ñ‚Ñ‹ â€” MySQL Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÑ‚ Ð´Ð°Ñ‚Ñƒ Ð² ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð½ÐµÐ¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸.

Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°: user_id, day_start
-----------------------------------------------------------------------------------------
ÐœÐ¾Ñ‘ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ:

WITH agroups AS (
SELECT user_id, adate,
    to_days(adate) - dense_rank() OVER w AS group_id
FROM activity
WHERE points >0
WINDOW w AS (PARTITION BY user_id ORDER BY adate)
)
SELECT 
    user_id,
    MIN(adate) AS day_start,
    MAX(adate) AS day_end,
    COUNT(*) AS day_count
FROM agroups
GROUP BY user_id, group_id
ORDER BY user_id, day_start
